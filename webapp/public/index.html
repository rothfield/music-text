<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Text</title>

    <!-- Retro mode redirect -->
    <noscript>
        <meta http-equiv="refresh" content="0; url=/retro">
    </noscript>
    <script>
        // Check for retro mode query parameters
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('retro') === 'true' || urlParams.get('nojs') === 'true') {
            window.location.href = '/retro';
        }
    </script>

    <script src="https://unpkg.com/tone@14.7.77/build/Tone.js"></script>
    <script src="js/vexflow-renderer.js"></script>
    <link rel="stylesheet" href="css/app.css">
</head>
<body>
    <div class="app">
        <div class="control-bar">
            <div class="controls">
                <button onclick="createNewDocument()" class="primary">New</button>
                <button onclick="parseMusic()">Parse</button>
                <button onclick="generateSVG()" class="secondary">LilyPond</button>
                <button onclick="clearAll()" class="secondary">Clear</button>
                <button onclick="toggleSlur()" class="secondary">Slur</button>


                <div class="octave-controls">
                    <span class="octave-label">Octave:</span>
                    <button onclick="applyOctaveAdjustment('lowest')" class="octave-btn" title="Lowest (: below)" disabled id="btn-lowest">LL</button>
                    <button onclick="applyOctaveAdjustment('lower')" class="octave-btn" title="Lower (. below)" disabled id="btn-lower">L</button>
                    <button onclick="applyOctaveAdjustment('middle')" class="octave-btn" title="Middle (remove octave marks)" disabled id="btn-middle">M</button>
                    <button onclick="applyOctaveAdjustment('higher')" class="octave-btn" title="Upper (. above)" disabled id="btn-higher">U</button>
                    <button onclick="applyOctaveAdjustment('highest')" class="octave-btn" title="Highest (: above)" disabled id="btn-highest">HH</button>
                </div>
                <div class="font-selector">
                    <label for="fontSelect">Font:</label>
                    <select id="fontSelect" onchange="changeFontFamily(this.value)">
                        <option value="font-default">Default Mono</option>
                        <option value="font-courier">Courier New</option>
                        <option value="font-source-code">Source Code Pro</option>
                        <option value="font-fira-code">Fira Code</option>
                        <option value="font-menlo">Menlo</option>
                    </select>
                </div>
            </div>
            <div id="status" class="status"></div>
        </div>
        
        <div id="canvasEditor" class="canvas-editor">
            <div id="svg-container" class="svg-container" tabindex="0"></div>
            <div id="canvasToolbar" class="canvas-toolbar">
                <button id="textMode" class="toolbar-btn active">Text Mode</button>
                <button id="visualMode" class="toolbar-btn">Visual Mode</button>
                <div class="toolbar-separator"></div>
                <button id="insertNote" class="toolbar-btn">Insert Note</button>
                <button id="insertBarline" class="toolbar-btn">Insert Barline</button>
                <button id="insertGraceNote" class="toolbar-btn">Grace Note</button>
            </div>
        </div>
        
        <div class="tabs">
            <div class="tab active" onclick="switchTab('editor_svg', this)">Editor</div>
            <div class="tab" onclick="switchTab('vexflow_svg', this)">VexFlow</div>
            <div class="tab" onclick="switchTab('lilypond_svg', this)">LilyPond SVG</div>
            <div class="tab" onclick="switchTab('lilypond_src', this)">LilyPond Source</div>
            <div class="tab" onclick="switchTab('document', this)">Document</div>
            <div class="tab" onclick="switchTab('midi', this)">MIDI</div>
        </div>
        
        <div id="editor_svg-tab" class="tab-content active">
            <div id="editor_svg-output" class="pipeline-section">Editor SVG source will appear here</div>
        </div>

        <div id="vexflow_svg-tab" class="tab-content">
            <div id="vexflow_svg-output">VexFlow SVG will appear here</div>
        </div>

        <div id="lilypond_svg-tab" class="tab-content">
            <div id="lilypond_svg-output">Click "LilyPond" to generate SVG</div>
        </div>

        <div id="lilypond_src-tab" class="tab-content">
            <div id="lilypond_src-output">Enter music notation to see LilyPond source</div>
        </div>
        
        <div id="document-tab" class="tab-content">
            <div id="document-output" class="pipeline-section">Enter music notation to see parsed document output</div>
        </div>

        <div id="midi-tab" class="tab-content">
            <div class="midi-tab-container">
                <div class="midi-controls">
                    <div class="midi-playback">
                        <button onclick="playMidi()" class="midi-btn play-btn" id="playBtn" title="Play MIDI">
                            <span class="midi-icon">▶️</span>
                            <span class="midi-label">Play</span>
                        </button>
                        <button onclick="pauseMidi()" class="midi-btn pause-btn" id="pauseBtn" title="Pause MIDI">
                            <span class="midi-icon">⏸️</span>
                            <span class="midi-label">Pause</span>
                        </button>
                        <button onclick="stopMidi()" class="midi-btn stop-btn" id="stopBtn" title="Stop MIDI">
                            <span class="midi-icon">⏹️</span>
                            <span class="midi-label">Stop</span>
                        </button>
                    </div>

                    <div class="midi-tempo">
                        <label for="tempoSlider">Tempo:</label>
                        <input type="range" id="tempoSlider" min="40" max="208" value="120" onchange="setTempo(this.value)" title="Tempo (BPM)">
                        <span id="tempoDisplay">120 BPM</span>
                    </div>

                    <div class="midi-info">
                        <div id="midiStatus" class="midi-status">Ready</div>
                        <div id="midiPosition" class="midi-position">0:00 / 0:00</div>
                    </div>
                </div>

                <div class="midi-visualization">
                    <canvas id="midiCanvas" width="800" height="200"></canvas>
                    <div id="midiOutput" class="midi-output">
                        Enter music notation to see MIDI representation and enable playback
                    </div>
                </div>
            </div>
        </div>


    </div></body>

    <script type="module" src="js/app.js"></script>
</body>
</html>
