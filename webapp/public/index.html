<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Text</title>

    <!-- Retro mode redirect -->
    <noscript>
        <meta http-equiv="refresh" content="0; url=/retro">
    </noscript>
    <script>
        // Check for retro mode query parameters
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('retro') === 'true' || urlParams.get('nojs') === 'true') {
            window.location.href = '/retro';
        }
    </script>

    <script src="https://unpkg.com/tone@14.7.77/build/Tone.js"></script>
    <link rel="stylesheet" href="css/app.css">
</head>
<body>
    <div class="app">
        <div class="control-bar">
            <div class="controls">
                <button onclick="parseMusic()">Parse</button>
                <button onclick="generateSVG()" class="secondary">LilyPond</button>
                <button onclick="clearAll()" class="secondary">Clear</button>
                <button onclick="toggleSlur()" class="secondary">Slur</button>


                <div class="octave-controls">
                    <span class="octave-label">Octave:</span>
                    <button onclick="applyOctaveAdjustment('lowest')" class="octave-btn" title="Lowest (-2 octaves)" disabled id="btn-lowest">↓↓↓</button>
                    <button onclick="applyOctaveAdjustment('lowish')" class="octave-btn" title="Lowish (-1 octave)" disabled id="btn-lowish">↓↓</button>
                    <button onclick="applyOctaveAdjustment('lower')" class="octave-btn" title="Lower (-1 octave)" disabled id="btn-lower">↓</button>
                    <button onclick="applyOctaveAdjustment('higher')" class="octave-btn" title="Higher (+1 octave)" disabled id="btn-higher">↑</button>
                    <button onclick="applyOctaveAdjustment('highish')" class="octave-btn" title="Highish (+1 octave)" disabled id="btn-highish">↑↑</button>
                    <button onclick="applyOctaveAdjustment('highest')" class="octave-btn" title="Highest (+3 octaves)" disabled id="btn-highest">↑↑↑</button>
                </div>
                <div class="font-selector">
                    <label for="fontSelect">Font:</label>
                    <select id="fontSelect" onchange="changeFontFamily(this.value)">
                        <option value="font-default">Default Mono</option>
                        <option value="font-courier">Courier New</option>
                        <option value="font-source-code">Source Code Pro</option>
                        <option value="font-fira-code">Fira Code</option>
                        <option value="font-menlo">Menlo</option>
                    </select>
                </div>
            </div>
            <div id="status" class="status"></div>
        </div>
        
        <div id="canvasEditor" class="canvas-editor">
            <canvas id="musicCanvas" width="800" height="400"></canvas>
            <div id="canvasToolbar" class="canvas-toolbar">
                <button id="textMode" class="toolbar-btn active">Text Mode</button>
                <button id="visualMode" class="toolbar-btn">Visual Mode</button>
                <div class="toolbar-separator"></div>
                <button id="insertNote" class="toolbar-btn">Insert Note</button>
                <button id="insertBarline" class="toolbar-btn">Insert Barline</button>
                <button id="insertGraceNote" class="toolbar-btn">Grace Note</button>
            </div>
        </div>
        
        <div class="tabs">
            <div class="tab active" onclick="switchTab('vexflow', this)">VexFlow Draft</div>
            <div class="tab" onclick="switchTab('svg', this)">LilyPond SVG</div>
            <div class="tab" onclick="switchTab('lilypond', this)">LilyPond Src (minimal)</div>
            <div class="tab" onclick="switchTab('lilypond-full', this)">LilyPond Src</div>
            <div class="tab" onclick="switchTab('document', this)">Document</div>
            <div class="tab" onclick="switchTab('midi', this)">MIDI</div>
            <div class="tab" onclick="switchTab('source', this)">Source</div>
            <div class="tab" onclick="switchTab('svg-source', this)">Canvas SVG Source</div>
        </div>
        
        <div id="vexflow-tab" class="tab-content active">
            <div id="vexflow-output"></div>
        </div>

        <div id="svg-tab" class="tab-content">
            <div id="svg-output">Click "LilyPond" to generate SVG</div>
        </div>
        
        <div id="lilypond-tab" class="tab-content">
            <div id="lilypond-output">Enter music notation above to see minimal LilyPond source</div>
        </div>

        <div id="lilypond-full-tab" class="tab-content">
            <div id="lilypond-full-output">Enter music notation above to see full LilyPond source</div>
        </div>
        
        <div id="document-tab" class="tab-content">
            <div id="document-output" class="pipeline-section">Enter music notation to see parsed document output</div>
        </div>

        <div id="midi-tab" class="tab-content">
            <div class="midi-tab-container">
                <div class="midi-controls">
                    <div class="midi-playback">
                        <button onclick="playMidi()" class="midi-btn play-btn" id="playBtn" title="Play MIDI">
                            <span class="midi-icon">▶️</span>
                            <span class="midi-label">Play</span>
                        </button>
                        <button onclick="pauseMidi()" class="midi-btn pause-btn" id="pauseBtn" title="Pause MIDI">
                            <span class="midi-icon">⏸️</span>
                            <span class="midi-label">Pause</span>
                        </button>
                        <button onclick="stopMidi()" class="midi-btn stop-btn" id="stopBtn" title="Stop MIDI">
                            <span class="midi-icon">⏹️</span>
                            <span class="midi-label">Stop</span>
                        </button>
                    </div>

                    <div class="midi-tempo">
                        <label for="tempoSlider">Tempo:</label>
                        <input type="range" id="tempoSlider" min="40" max="208" value="120" onchange="setTempo(this.value)" title="Tempo (BPM)">
                        <span id="tempoDisplay">120 BPM</span>
                    </div>

                    <div class="midi-info">
                        <div id="midiStatus" class="midi-status">Ready</div>
                        <div id="midiPosition" class="midi-position">0:00 / 0:00</div>
                    </div>
                </div>

                <div class="midi-visualization">
                    <canvas id="midiCanvas" width="800" height="200"></canvas>
                    <div id="midiOutput" class="midi-output">
                        Enter music notation to see MIDI representation and enable playback
                    </div>
                </div>
            </div>
        </div>

        <div id="source-tab" class="tab-content">
            <div id="source-output" class="pipeline-section">Plain text will appear here after parsing</div>
        </div>

        <div id="svg-source-tab" class="tab-content">
            <div id="svg-source-output" class="pipeline-section">SVG source code will appear here</div>
        </div>
    </div></body>

    <script type="module" src="js/app.js"></script>
</body>
</html>
