<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Text</title>

    <!-- Retro mode redirect -->
    <noscript>
        <meta http-equiv="refresh" content="0; url=/retro">
    </noscript>
    <script>
        // Check for retro mode query parameters
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('retro') === 'true' || urlParams.get('nojs') === 'true') {
            window.location.href = '/retro';
        }
    </script>

    <script src="https://unpkg.com/tone@14.7.77/build/Tone.js"></script>
    <link rel="stylesheet" href="css/app.css">
    <link rel="stylesheet" href="css/code-editor.css">
    <link rel="stylesheet" href="assets/codemirror.min.css">
</head>
<body>
    <div class="app">
        <div class="control-bar">
            <div class="controls">
                <button onclick="parseMusic()">Parse</button>
                <button onclick="generateSVG()" class="secondary">LilyPond</button>
                <button onclick="clearAll()" class="secondary">Clear</button>
                <button onclick="toggleSlur()" class="secondary">Slur</button>

                <div class="midi-controls">
                    <button onclick="playMidi()" class="midi-btn" id="playBtn" title="Play MIDI">▶️</button>
                    <button onclick="pauseMidi()" class="midi-btn" id="pauseBtn" title="Pause MIDI">⏸️</button>
                    <button onclick="stopMidi()" class="midi-btn" id="stopBtn" title="Stop MIDI">⏹️</button>
                    <input type="range" id="tempoSlider" min="40" max="208" value="120" onchange="setTempo(this.value)" title="Tempo (BPM)">
                    <span id="tempoDisplay">120 BPM</span>
                </div>

                <div class="octave-controls">
                    <span class="octave-label">Octave:</span>
                    <button onclick="applyOctaveAdjustment('lowest')" class="octave-btn" title="Lowest (-2 octaves)" disabled id="btn-lowest">↓↓↓</button>
                    <button onclick="applyOctaveAdjustment('lowish')" class="octave-btn" title="Lowish (-1 octave)" disabled id="btn-lowish">↓↓</button>
                    <button onclick="applyOctaveAdjustment('lower')" class="octave-btn" title="Lower (-1 octave)" disabled id="btn-lower">↓</button>
                    <button onclick="applyOctaveAdjustment('higher')" class="octave-btn" title="Higher (+1 octave)" disabled id="btn-higher">↑</button>
                    <button onclick="applyOctaveAdjustment('highish')" class="octave-btn" title="Highish (+1 octave)" disabled id="btn-highish">↑↑</button>
                    <button onclick="applyOctaveAdjustment('highest')" class="octave-btn" title="Highest (+3 octaves)" disabled id="btn-highest">↑↑↑</button>
                </div>
                <div class="font-selector">
                    <label for="fontSelect">Font:</label>
                    <select id="fontSelect" onchange="changeFontFamily(this.value)">
                        <option value="font-default">Default Mono</option>
                        <option value="font-courier">Courier New</option>
                        <option value="font-source-code">Source Code Pro</option>
                        <option value="font-fira-code">Fira Code</option>
                        <option value="font-menlo">Menlo</option>
                    </select>
                </div>
            </div>
            <div id="status" class="status"></div>
        </div>
        
        <div id="musicInput"></div>
        
        <div class="tabs">
            <div class="tab active" onclick="switchTab('vexflow', this)">VexFlow Draft</div>
            <div class="tab" onclick="switchTab('svg', this)">LilyPond SVG</div>
            <div class="tab" onclick="switchTab('svgpoc', this)">SVG POC</div>
            <div class="tab" onclick="switchTab('lilypond', this)">LilyPond Src (minimal)</div>
            <div class="tab" onclick="switchTab('lilypond-full', this)">LilyPond Src</div>
            <div class="tab" onclick="switchTab('document', this)">Document</div>
            <div class="tab" onclick="switchTab('spans', this)">Spans</div>
            <div class="tab" onclick="switchTab('styles', this)">Span Classes</div>
            <div class="tab" onclick="switchTab('source', this)">Source</div>
        </div>
        
        <div id="vexflow-tab" class="tab-content active">
            <div id="vexflow-output"></div>
        </div>
        
        <div id="svg-tab" class="tab-content">
            <div id="svg-output">Click "LilyPond" to generate SVG</div>
        </div>

        <div id="svgpoc-tab" class="tab-content">
            <div class="svgpoc-controls">
                <button onclick="generateSVGPOC()" class="primary">Generate SVG POC</button>
                <select id="notationTypeSelect" onchange="updateNotationType()">
                    <option value="number">Number (1,2,3...)</option>
                    <option value="sargam">Sargam (S,R,G...)</option>
                    <option value="western">Western (C,D,E...)</option>
                </select>
            </div>
            <div id="svgpoc-output">Enter music notation and click "Generate SVG POC" to test the SVG renderer</div>
        </div>
        
        <div id="lilypond-tab" class="tab-content">
            <div id="lilypond-output">Enter music notation above to see minimal LilyPond source</div>
        </div>

        <div id="lilypond-full-tab" class="tab-content">
            <div id="lilypond-full-output">Enter music notation above to see full LilyPond source</div>
        </div>
        
        <div id="document-tab" class="tab-content">
            <div id="document-output" class="pipeline-section">Enter music notation to see parsed document output</div>
        </div>
        

        <div id="spans-tab" class="tab-content">
            <div id="spans-output" class="pipeline-section">Enter music notation to see spans</div>
        </div>

        <div id="styles-tab" class="tab-content">
            <div id="styles-output" class="pipeline-section">Enter music notation to see span classes</div>
        </div>

        <div id="source-tab" class="tab-content">
            <div id="source-output" class="pipeline-section">Plain text will appear here after parsing</div>
        </div>
    </div></body>

    <script src="assets/codemirror.min.js"></script>
    <script src="assets/xml-mode.js"></script>
    <script type="module" src="js/app.js"></script>
</body>
</html>