<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VexFlow Tuplet Test for S-R</title>
    <script src="lib/vexflow.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 8px;
        }
        #notation {
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <h1>VexFlow Tuplet Test: S-R (Sargam Notation)</h1>
    
    <div class="test-section">
        <h2>Simple Triplet: S-R-G</h2>
        <div id="notation1"></div>
    </div>
    
    <div class="test-section">
        <h2>C4 D8 Tuplet (filling one beat)</h2>
        <div id="notation2"></div>
    </div>
    
    <div class="test-section">
        <h2>Mixed Tuplet: S-R with G-M</h2>
        <div id="notation3"></div>
    </div>

    <script>
        const { Renderer, Stave, StaveNote, Voice, Formatter, Tuplet, Beam } = Vex.Flow;

        // Test 1: Simple triplet S-R-G (equivalent to C-D-E)
        function renderTriplet() {
            const div = document.getElementById('notation1');
            const renderer = new Renderer(div, Renderer.Backends.SVG);
            renderer.resize(500, 200);
            const context = renderer.getContext();
            
            const stave = new Stave(10, 40, 400);
            stave.addClef('treble').addTimeSignature('4/4');
            stave.setContext(context).draw();
            
            // S-R-G mapped to C-D-E quarter notes in a triplet (takes 2 beats) + half note (2 beats)
            const notes = [
                new StaveNote({ clef: 'treble', keys: ['c/4'], duration: '4' }),
                new StaveNote({ clef: 'treble', keys: ['d/4'], duration: '4' }),
                new StaveNote({ clef: 'treble', keys: ['e/4'], duration: '4' }),
                new StaveNote({ clef: 'treble', keys: ['f/4'], duration: '2' }) // half note to complete measure
            ];
            
            // Create tuplet for first 3 notes (S-R-G) - occupies 2 beats
            const tuplet = new Tuplet(notes.slice(0, 3), {
                notes_occupied: 2  // Triplet takes 2 beats instead of 3
            });
            
            const voice = new Voice({ num_beats: 4, beat_value: 4 });
            voice.setStrict(false);
            voice.addTickables(notes);
            
            new Formatter().joinVoices([voice]).format([voice], 300);
            voice.draw(context, stave);
            tuplet.setContext(context).draw();
        }

        // Test 2: C4 D8 as tuplet filling one beat
        function renderDuplet() {
            const div = document.getElementById('notation2');
            const renderer = new Renderer(div, Renderer.Backends.SVG);
            renderer.resize(500, 200);
            const context = renderer.getContext();
            
            const stave = new Stave(10, 40, 400);
            stave.addClef('treble').addTimeSignature('4/4');
            stave.setContext(context).draw();
            
            // C quarter note and D eighth note as duplet filling exactly one beat
            const notes = [
                new StaveNote({ clef: 'treble', keys: ['c/4'], duration: '4' }),  // C4 (quarter note)
                new StaveNote({ clef: 'treble', keys: ['d/4'], duration: '8' }),  // D8 (eighth note)
                new StaveNote({ clef: 'treble', keys: ['e/4'], duration: '2' }),  // Half note to fill remaining 3 beats
            ];
            
            // Create tuplet for C4 + D8 = filling one beat (quarter note duration)
            // This is a "3" tuplet because the notes would normally take 1.5 beats (4+8 = 6/8 beats)
            // but we're compressing them into 1 beat
            const tuplet = new Tuplet(notes.slice(0, 2), {
                notes_occupied: 2,  // Normal duration would be 2 eighth notes (1 beat)  
                num_notes: 3        // But shows "3" because we're fitting 3 eighth-note-equivalents into 2
            });
            
            const voice = new Voice({ num_beats: 4, beat_value: 4 });
            voice.setStrict(false);
            voice.addTickables(notes);
            
            new Formatter().joinVoices([voice]).format([voice], 300);
            voice.draw(context, stave);
            tuplet.setContext(context).draw();
        }

        // Test 3: Mixed - S-R tuplet followed by G-M
        function renderMixed() {
            const div = document.getElementById('notation3');
            const renderer = new Renderer(div, Renderer.Backends.SVG);
            renderer.resize(500, 200);
            const context = renderer.getContext();
            
            const stave = new Stave(10, 40, 400);
            stave.addClef('treble').addTimeSignature('4/4');
            stave.setContext(context).draw();
            
            // S-R-G as eighth note triplet (1 beat), then quarter + half note (3 beats)
            const notes = [
                new StaveNote({ clef: 'treble', keys: ['c/4'], duration: '8' }), // S
                new StaveNote({ clef: 'treble', keys: ['d/4'], duration: '8' }), // R
                new StaveNote({ clef: 'treble', keys: ['e/4'], duration: '8' }), // G (3rd note of triplet)
                new StaveNote({ clef: 'treble', keys: ['f/4'], duration: '4' }), // M (quarter note)
                new StaveNote({ clef: 'treble', keys: ['g/4'], duration: '2' })  // Half note to complete measure
            ];
            
            // Create triplet for first 3 notes (S-R-G) - takes 1 beat
            const tuplet = new Tuplet(notes.slice(0, 3), {
                notes_occupied: 1  // Triplet takes 1 beat (quarter note duration)
            });
            
            // Create beam for the triplet
            const beam = new Beam(notes.slice(0, 3));
            
            const voice = new Voice({ num_beats: 4, beat_value: 4 });
            voice.setStrict(false);
            voice.addTickables(notes);
            
            new Formatter().joinVoices([voice]).format([voice], 300);
            voice.draw(context, stave);
            beam.setContext(context).draw();
            tuplet.setContext(context).draw();
        }

        // Render all tests
        renderTriplet();
        renderDuplet();
        renderMixed();
        
        console.log('VexFlow Tuplet Test for S-R rendered successfully!');
    </script>
</body>
</html>