<!DOCTYPE html>
<html>
<head>
    <title>VexFlow 5 - Full Feature Test</title>
    <script src="https://cdn.jsdelivr.net/npm/vexflow@5.0.1/build/vexflow.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        .success { color: green; }
        .error { color: red; }
        h2 { color: #333; }
    </style>
</head>
<body>
    <h1>VexFlow 5 - Full Feature Test</h1>
    
    <div class="test-section">
        <h2>1. Basic Notes</h2>
        <div id="basic-notes"></div>
        <div id="basic-notes-result"></div>
    </div>
    
    <div class="test-section">
        <h2>2. Slurs</h2>
        <div id="slurs"></div>
        <div id="slurs-result"></div>
    </div>
    
    <div class="test-section">
        <h2>3. Ties</h2>
        <div id="ties"></div>
        <div id="ties-result"></div>
    </div>
    
    <div class="test-section">
        <h2>4. Tuplets</h2>
        <div id="tuplets"></div>
        <div id="tuplets-result"></div>
    </div>
    
    <script>
        function testFeature(divId, resultId, testName, testFunc) {
            try {
                testFunc();
                document.getElementById(resultId).innerHTML = `<p class="success">✅ ${testName} works!</p>`;
            } catch (e) {
                document.getElementById(resultId).innerHTML = `<p class="error">❌ ${testName} failed: ${e.message}</p>`;
                console.error(`${testName} error:`, e);
            }
        }
        
        // Test 1: Basic Notes
        testFeature('basic-notes', 'basic-notes-result', 'Basic Notes', () => {
            const { Renderer, Stave, StaveNote, Voice, Formatter, Accidental } = VF;
            
            const div = document.getElementById('basic-notes');
            const renderer = new Renderer(div, Renderer.Backends.SVG);
            renderer.resize(500, 150);
            const context = renderer.getContext();
            
            const stave = new Stave(10, 10, 400);
            stave.addClef('treble');
            stave.setContext(context).draw();
            
            const notes = [
                new StaveNote({ clef: 'treble', keys: ['c/4'], duration: 'q' }),
                new StaveNote({ clef: 'treble', keys: ['d/4'], duration: 'q' }),
                new StaveNote({ clef: 'treble', keys: ['e/4'], duration: 'q' }),
                new StaveNote({ clef: 'treble', keys: ['f#/4'], duration: 'q' })
            ];
            
            // Add accidental to F#
            notes[3].addModifier(new Accidental('#'), 0);
            
            const voice = new Voice({ num_beats: 4, beat_value: 4 });
            voice.addTickables(notes);
            
            new Formatter().joinVoices([voice]).format([voice], 350);
            voice.draw(context, stave);
        });
        
        // Test 2: Slurs
        testFeature('slurs', 'slurs-result', 'Slurs', () => {
            const { Renderer, Stave, StaveNote, Voice, Formatter, Curve } = VF;
            
            const div = document.getElementById('slurs');
            const renderer = new Renderer(div, Renderer.Backends.SVG);
            renderer.resize(500, 150);
            const context = renderer.getContext();
            
            const stave = new Stave(10, 10, 400);
            stave.addClef('treble');
            stave.setContext(context).draw();
            
            const notes = [
                new StaveNote({ clef: 'treble', keys: ['c/4'], duration: 'q' }),
                new StaveNote({ clef: 'treble', keys: ['d/4'], duration: 'q' }),
                new StaveNote({ clef: 'treble', keys: ['e/4'], duration: 'q' }),
                new StaveNote({ clef: 'treble', keys: ['f/4'], duration: 'q' })
            ];
            
            const voice = new Voice({ num_beats: 4, beat_value: 4 });
            voice.addTickables(notes);
            
            new Formatter().joinVoices([voice]).format([voice], 350);
            voice.draw(context, stave);
            
            // Add slur
            const curve = new Curve(notes[0], notes[2], { cps: [{x: 0, y: 10}, {x: 0, y: 10}] });
            curve.setContext(context).draw();
        });
        
        // Test 3: Ties
        testFeature('ties', 'ties-result', 'Ties', () => {
            const { Renderer, Stave, StaveNote, Voice, Formatter, StaveTie } = VF;
            
            const div = document.getElementById('ties');
            const renderer = new Renderer(div, Renderer.Backends.SVG);
            renderer.resize(500, 150);
            const context = renderer.getContext();
            
            const stave = new Stave(10, 10, 400);
            stave.addClef('treble');
            stave.setContext(context).draw();
            
            const notes = [
                new StaveNote({ clef: 'treble', keys: ['c/4'], duration: 'h' }),
                new StaveNote({ clef: 'treble', keys: ['c/4'], duration: 'h' })
            ];
            
            const voice = new Voice({ num_beats: 4, beat_value: 4 });
            voice.addTickables(notes);
            
            new Formatter().joinVoices([voice]).format([voice], 350);
            voice.draw(context, stave);
            
            // Add tie
            const tie = new StaveTie({
                first_note: notes[0],
                last_note: notes[1],
                first_indices: [0],
                last_indices: [0]
            });
            tie.setContext(context).draw();
        });
        
        // Test 4: Tuplets
        testFeature('tuplets', 'tuplets-result', 'Tuplets', () => {
            const { Renderer, Stave, StaveNote, Voice, Formatter, Tuplet } = VF;
            
            const div = document.getElementById('tuplets');
            const renderer = new Renderer(div, Renderer.Backends.SVG);
            renderer.resize(500, 150);
            const context = renderer.getContext();
            
            const stave = new Stave(10, 10, 400);
            stave.addClef('treble');
            stave.setContext(context).draw();
            
            const notes = [
                new StaveNote({ clef: 'treble', keys: ['c/4'], duration: '8' }),
                new StaveNote({ clef: 'treble', keys: ['d/4'], duration: '8' }),
                new StaveNote({ clef: 'treble', keys: ['e/4'], duration: '8' }),
                new StaveNote({ clef: 'treble', keys: ['f/4'], duration: 'q' })
            ];
            
            const voice = new Voice({ num_beats: 4, beat_value: 4 });
            voice.addTickables(notes);
            
            // Create tuplet for first 3 notes
            const tuplet = new Tuplet(notes.slice(0, 3), {
                num_notes: 3,
                notes_occupied: 2
            });
            
            new Formatter().joinVoices([voice]).format([voice], 350);
            voice.draw(context, stave);
            tuplet.setContext(context).draw();
        });
        
        // Check VexFlow version
        if (typeof VF !== 'undefined') {
            console.log('VexFlow 5 loaded. Build info:', VF.BUILD);
        }
    </script>
</body>
</html>