<!DOCTYPE html>
<html>
<head>
    <title>Comprehensive Tuplet Test</title>
    <script src="lib/vexflow5.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-case { margin: 20px 0; border: 1px solid #ccc; padding: 10px; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>Comprehensive Tuplet Test - VexFlow 5</h1>
    
    <div class="test-case">
        <h2>Test 1: Triplet (3 notes in the space of 2)</h2>
        <div id="triplet"></div>
    </div>
    
    <div class="test-case">
        <h2>Test 2: Quintuplet (5 notes in the space of 4)</h2>
        <div id="quintuplet"></div>
    </div>
    
    <div class="test-case">
        <h2>Test 3: Septuplet (7 notes in the space of 4)</h2>
        <div id="septuplet"></div>
    </div>
    
    <script>
        const { Renderer, Stave, Formatter, Voice, StaveNote, Tuplet, Beam } = VexFlow;
        
        function createTupletTest(divId, noteCount, notesOccupied, duration = '16') {
            try {
                const div = document.getElementById(divId);
                const renderer = new Renderer(div, Renderer.Backends.SVG);
                renderer.resize(500, 150);
                const context = renderer.getContext();
                
                const stave = new Stave(10, 20, 400);
                stave.addClef('treble');
                stave.setContext(context);
                stave.draw();
                
                // Create notes for the tuplet
                const notes = [];
                const pitches = ['c/4', 'd/4', 'e/4', 'f/4', 'g/4', 'a/4', 'b/4'];
                for (let i = 0; i < noteCount; i++) {
                    notes.push(new StaveNote({ 
                        clef: 'treble', 
                        keys: [pitches[i % pitches.length]], 
                        duration: duration 
                    }));
                }
                
                // Create tuplet with camelCase properties (the fix)
                const tuplet = new Tuplet(notes, { 
                    notesOccupied: notesOccupied, 
                    numNotes: noteCount 
                });
                tuplet.setContext(context);
                
                // Create beam for the tuplet notes
                const beam = new Beam(notes);
                
                // Calculate appropriate beats for the voice
                const beatValue = parseInt(duration) || 4;
                const numBeats = notesOccupied;
                
                // Create voice and format
                const voice = new Voice({ num_beats: numBeats, beat_value: beatValue });
                voice.addTickables(notes);
                
                new Formatter().joinVoices([voice]).format([voice], 350);
                voice.draw(context, stave);
                beam.draw();
                tuplet.draw();
                
                // Add success message
                const msg = document.createElement('p');
                msg.className = 'success';
                msg.textContent = `✓ ${noteCount}-tuplet rendered successfully!`;
                div.parentElement.appendChild(msg);
                
                console.log(`✓ ${noteCount}-tuplet created successfully`);
            } catch (e) {
                console.error(`✗ Error creating ${noteCount}-tuplet:`, e);
                
                const msg = document.createElement('p');
                msg.className = 'error';
                msg.textContent = `✗ Error: ${e.message}`;
                document.getElementById(divId).parentElement.appendChild(msg);
            }
        }
        
        // Run tests
        createTupletTest('triplet', 3, 2, '8');      // Triplet: 3 eighth notes in space of 2
        createTupletTest('quintuplet', 5, 4, '16');  // Quintuplet: 5 sixteenth notes in space of 4  
        createTupletTest('septuplet', 7, 4, '16');   // Septuplet: 7 sixteenth notes in space of 4
        
        console.log('All tuplet tests completed!');
    </script>
</body>
</html>