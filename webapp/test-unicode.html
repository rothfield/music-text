<!DOCTYPE html>
<html>
<head>
    <title>Unicode Character Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        textarea { 
            width: 100%;
            height: 100px;
            font-family: 'Consolas', monospace;
            font-size: 24px;
            font-weight: bold;
            border: 1px solid #ccc;
            padding: 10px;
            resize: vertical;
        }
        .output { background: #f5f5f5; padding: 10px; margin: 10px 0; border-radius: 4px; }
        button { padding: 8px 16px; margin: 5px; }
    </style>
</head>
<body>
    <h1>Unicode Character Conversion Test</h1>
    
    <div class="test-section">
        <h3>1. Test Input (Type - . | and see conversion)</h3>
        <textarea id="testInput" placeholder="Type: 1-2-3 | S.R.G | C-D-E"></textarea>
        <div>
            <button onclick="testConversion()">Test Conversion Functions</button>
            <button onclick="testApiCall()">Test API Call with Conversion</button>
        </div>
        <div id="conversionOutput" class="output"></div>
        <div id="apiOutput" class="output"></div>
    </div>

    <script>
        // Unicode character replacements (same as webapp)
        const UNICODE_REPLACEMENTS = {
            '-': '▬',  // Black rectangle for dashes
            '.': '•',  // Bullet for dots
            '|': '┃'   // Heavy vertical line for barlines
        };

        // Apply Unicode replacements to input (for display)
        function applyUnicodeReplacements(text) {
            let result = text;
            for (const [original, replacement] of Object.entries(UNICODE_REPLACEMENTS)) {
                result = result.replace(new RegExp('\\' + original, 'g'), replacement);
            }
            return result;
        }

        // Convert Unicode back to standard characters for backend processing
        function convertUnicodeToStandard(text) {
            let result = text;
            for (const [original, replacement] of Object.entries(UNICODE_REPLACEMENTS)) {
                result = result.replace(new RegExp('\\' + replacement.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g'), original);
            }
            return result;
        }

        // Setup real-time character replacement
        document.getElementById('testInput').addEventListener('keydown', function(e) {
            const replacement = UNICODE_REPLACEMENTS[e.key];
            if (replacement) {
                e.preventDefault();
                const start = e.target.selectionStart;
                const end = e.target.selectionEnd;
                const value = e.target.value;
                
                e.target.value = value.substring(0, start) + replacement + value.substring(end);
                e.target.setSelectionRange(start + 1, start + 1);
            }
        });

        function testConversion() {
            const input = document.getElementById('testInput').value;
            const withUnicode = applyUnicodeReplacements(input);
            const backToStandard = convertUnicodeToStandard(withUnicode);
            
            document.getElementById('conversionOutput').innerHTML = `
                <strong>Conversion Test:</strong><br>
                Original: "${input}"<br>
                With Unicode: "${withUnicode}"<br>
                Back to Standard: "${backToStandard}"<br>
                Round-trip Success: ${input === backToStandard ? '✅' : '❌'}
            `;
        }

        async function testApiCall() {
            const input = document.getElementById('testInput').value;
            const standardInput = convertUnicodeToStandard(input);
            
            try {
                const response = await fetch(`/api/parse?input=${encodeURIComponent(standardInput)}`);
                const data = await response.json();
                
                document.getElementById('apiOutput').innerHTML = `
                    <strong>API Test:</strong><br>
                    Input Sent: "${standardInput}"<br>
                    Success: ${data.success ? '✅' : '❌'}<br>
                    Detected Systems: ${data.detected_notation_systems || 'none'}<br>
                    ${data.error ? `Error: ${data.error}` : ''}
                `;
            } catch (error) {
                document.getElementById('apiOutput').innerHTML = `
                    <strong>API Error:</strong> ${error.message}
                `;
            }
        }

        console.log('Unicode test page loaded');
        console.log('Type -, ., | to see real-time replacements');
    </script>
</body>
</html>