<!DOCTYPE html>
<html>
<head>
    <title>JavaScript Integration Test</title>
    <link rel="stylesheet" href="webapp/public/css/music-text.css">
    <style>
        body {
            font-family: monospace;
            font-size: 16px;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 10px 0;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        .editor-simulation {
            border: 1px solid #ccc;
            padding: 10px;
            background: white;
            font-family: monospace;
            min-height: 50px;
        }
    </style>
</head>
<body>
    <h1>JavaScript Integration Test</h1>

    <div class="test-section">
        <h3>Static HTML Test (should work):</h3>
        <div class="editor-simulation">
            <span class="cm-music-note beat-loop-4">1</span><span class="cm-music-note">2</span><span class="cm-music-note">3</span><span class="cm-music-note">4</span>
        </div>
    </div>

    <div class="test-section">
        <h3>JavaScript Applied Test:</h3>
        <div id="dynamic-editor" class="editor-simulation">1234</div>
        <button onclick="applyStyles()">Apply Styles</button>
    </div>

    <div class="test-section">
        <h3>CLI Output Simulation:</h3>
        <div id="cli-simulation" class="editor-simulation">1234</div>
        <button onclick="simulateCLIOutput()">Simulate CLI Data</button>
    </div>

    <script>
        function applyStyles() {
            const editor = document.getElementById('dynamic-editor');
            editor.innerHTML = '';

            // Simulate what the frontend should do
            const span1 = document.createElement('span');
            span1.textContent = '1';
            span1.className = 'cm-music-note beat-loop-4';

            const span2 = document.createElement('span');
            span2.textContent = '2';
            span2.className = 'cm-music-note';

            const span3 = document.createElement('span');
            span3.textContent = '3';
            span3.className = 'cm-music-note';

            const span4 = document.createElement('span');
            span4.textContent = '4';
            span4.className = 'cm-music-note';

            editor.appendChild(span1);
            editor.appendChild(span2);
            editor.appendChild(span3);
            editor.appendChild(span4);
        }

        function simulateCLIOutput() {
            // This simulates the exact output from CLI
            const characterStyles = [
                {
                    "pos": 0,
                    "length": 1,
                    "classes": ["cm-music-note", "beat-loop-4"]
                },
                {
                    "pos": 1,
                    "length": 1,
                    "classes": ["cm-music-note"]
                },
                {
                    "pos": 2,
                    "length": 1,
                    "classes": ["cm-music-note"]
                },
                {
                    "pos": 3,
                    "length": 1,
                    "classes": ["cm-music-note"]
                }
            ];

            const editor = document.getElementById('cli-simulation');
            const text = '1234';
            editor.innerHTML = '';

            characterStyles.forEach(style => {
                const span = document.createElement('span');
                span.textContent = text.charAt(style.pos);
                span.className = style.classes.join(' ');
                editor.appendChild(span);
            });

            console.log('Applied character styles:', characterStyles);
        }
    </script>
</body>
</html>